<div class="image-attachment-wrapper">
    <img style="@_style" class="attached-image" src="@Attachment.Location" width="@Attachment.Width" height="@Attachment.Height" @onclick="OnClick" />
</div>

@code {
    private bool enlarged = false;

    [Parameter]
    public MessageAttachment Attachment { get; set; }

    [Parameter]
    public MessageComponent MessageComponent { get; set; }

    private string _style;

    protected override void OnInitialized()
    {
        LoadStyle(300f);
    }

    public void LoadStyle(float maxSizePixels)
    {
        float scalar;

        if (Attachment.Height > Attachment.Width)
            scalar = Attachment.Height / maxSizePixels;
        else
            scalar = Attachment.Width / maxSizePixels;

        float heightMax = Attachment.Height / scalar;
        float widthMax = Attachment.Width / scalar;

        _style = $"max-height: min({heightMax}px, 60vh); max-width: min({widthMax}px, 90%)";
    }

    public void OnClick()
    {
        enlarged = !enlarged;

        if (enlarged)
            LoadStyle(900f);
        else
            LoadStyle(300f);

        StateHasChanged();
    }
}
